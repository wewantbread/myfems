<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sacred Element Cycle</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <button class="theme-toggle" type="button" aria-label="Toggle between night and day">
    <span class="theme-toggle__icon theme-toggle__icon--sun" aria-hidden="true"></span>
    <span class="theme-toggle__icon theme-toggle__icon--moon" aria-hidden="true"></span>
  </button>
  <main class="stage" aria-label="Meditative elemental aura animation">
    <p class="element-mantra" aria-hidden="true">EARTH · AIR · WATER · FIRE</p>
    <div class="figure" role="img" aria-label="Chakra aligned silhouette surrounded by elemental energy">
      <img src="chakragirl.png" alt="Meditative silhouette with illuminated chakras" class="figure__image" />
      <span class="figure__outline" aria-hidden="true"></span>
      <div class="deity-cycle" aria-hidden="true">
        <span class="deity deity--lakshmi"></span>
        <span class="deity deity--saraswati"></span>
        <span class="deity deity--shiva"></span>
        <span class="deity deity--ganesha"></span>
      </div>
      <span class="chakra chakra--third-eye" aria-hidden="true"></span>

      <div class="aura aura--air" aria-hidden="true">
        <span class="air-flow air-flow--primary"></span>
        <span class="air-flow air-flow--secondary"></span>
        <span class="air-trace air-trace--one"></span>
        <span class="air-trace air-trace--two"></span>
      </div>

      <div class="aura aura--leaves" aria-hidden="true">
        <span class="leaf" style="--index: 0"></span>
        <span class="leaf" style="--index: 1"></span>
        <span class="leaf" style="--index: 2"></span>
        <span class="leaf" style="--index: 3"></span>
        <span class="leaf" style="--index: 4"></span>
        <span class="leaf" style="--index: 5"></span>
        <span class="leaf" style="--index: 6"></span>
        <span class="leaf" style="--index: 7"></span>
        <span class="leaf" style="--index: 8"></span>
        <span class="leaf" style="--index: 9"></span>
        <span class="leaf" style="--index: 10"></span>
        <span class="leaf" style="--index: 11"></span>
        <span class="leaf" style="--index: 12"></span>
        <span class="leaf" style="--index: 13"></span>
        <span class="leaf" style="--index: 14"></span>
        <span class="leaf" style="--index: 15"></span>
      </div>

      <div class="aura aura--water" aria-hidden="true">
        <span class="water-ribbon water-ribbon--inner"></span>
        <span class="water-ribbon water-ribbon--outer"></span>
        <span class="droplet" style="--offset: 0"></span>
        <span class="droplet" style="--offset: 1"></span>
        <span class="droplet" style="--offset: 2"></span>
      </div>

      <div class="aura aura--fire" aria-hidden="true">
        <span class="ember" style="--ember: 0"></span>
        <span class="ember" style="--ember: 1"></span>
        <span class="ember" style="--ember: 2"></span>
        <span class="ember" style="--ember: 3"></span>
        <span class="ember" style="--ember: 4"></span>
        <span class="ember" style="--ember: 5"></span>
      </div>
    </div>
    <section class="integration-panel" aria-label="Integration timer and affirmation">
      <p class="integration-panel__words" aria-hidden="true">
        <span>rewire</span>
        <span>heal</span>
        <span>reset</span>
      </p>
      <div class="countdown" role="timer" aria-live="polite" aria-atomic="true" aria-label="Two minute integration countdown">
        <div class="countdown__ring" aria-hidden="true"></div>
        <span class="countdown__time">02:00</span>
      </div>
    </section>
  </main>
  <script>
    const body = document.body;
    const storedTheme = window.localStorage.getItem("chakra-theme");
    if (storedTheme === "night" || (!storedTheme && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      body.dataset.theme = "night";
    }

    document.querySelector(".theme-toggle")?.addEventListener("click", () => {
      const isNight = body.dataset.theme === "night";
      const nextTheme = isNight ? "day" : "night";
      if (nextTheme === "night") {
        body.dataset.theme = "night";
      } else {
        delete body.dataset.theme;
      }
      window.localStorage.setItem("chakra-theme", nextTheme);
    });

    const countdown = document.querySelector(".countdown");
    const countdownTime = document.querySelector(".countdown__time");
    const COUNTDOWN_DURATION = 120000;

    if (countdown && countdownTime) {
      let startTime = performance.now();

      const updateCountdown = (now) => {
        const elapsed = now - startTime;
        const remaining = Math.max(COUNTDOWN_DURATION - elapsed, 0);
        const totalSeconds = Math.ceil(remaining / 1000);
        const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
        const seconds = String(totalSeconds % 60).padStart(2, "0");
        countdownTime.textContent = `${minutes}:${seconds}`;

        const progress = Math.min(1, elapsed / COUNTDOWN_DURATION);
        countdown.style.setProperty("--countdown-angle", `${progress * 360}deg`);

        if (remaining <= 0) {
          startTime = now;
        }

        requestAnimationFrame(updateCountdown);
      };

      requestAnimationFrame(updateCountdown);
    }
  </script>
</body>
</html>
